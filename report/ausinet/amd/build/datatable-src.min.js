(function(a){"use strict";var b=function(b,c){this.options=c;this.table=b;this.currentPage=0;this.currentStart=0;this.filterIndex=[];this.table.addClass("datatable");if(0>this.options.nbColumns){this.options.nbColumns=this.table.find("thead tr").first().find("th").length}a(this.options.pagingDivSelector).addClass("pagination-data-tables").addClass(this.options.pagingDivClass);var d=a("<ul></ul>");d.addClass(this.options.pagingListClass);a(this.options.pagingDivSelector).html("").append(d);var e=this;if(0===this.table.find("thead").length){var f=a("<thead></thead>");f.append(this.table.find("th").parent("tr"));this.table.prepend(f)}if(0===this.table.find("tbody").length){a("<tbody></tbody>").insertAfter(this.table.find("thead").first())}if(jQuery.isArray(this.options.data)){this.data=this.options.data}else if(jQuery.isPlainObject(this.options.data)){if(this.table.data("size")){this.options.data.size=parseInt(this.table.data("size"),10)}if(this.options.data.refresh===void 0){this.options.data.refresh=!1}this.data=[];if(this.options.data.size!==void 0){a(this.options.loadingDivSelector).html("<div class=\"progress progress-striped active datatable-load-bar\"><div class=\"bar\" style=\"width: 0%;\"></div></div>");for(var g=0;g<this.options.data.size;g+=this.options.pageSize*this.options.pagingNumberOfPages){this.getAjaxDataAsync(g)}}else{a(this.options.loadingDivSelector).html("<div class=\"progress progress-striped active datatable-load-bar\"><div class=\"bar\" style=\"width: 100%;\"></div></div>");this.getAjaxDataSync()}}else{this.data=[];this.table.find("tbody tr").each(function(){var b=[];a(this).find("td").each(function(){b.push(a(this).html())});e.data.push(b)})}this.createSort();this.createFilter();this.triggerSort();this.filter()};b.prototype={constructor:b,clearAjaxLoading:function clearAjaxLoading(){if(this.options.data.refresh){this.refreshTimeOut=setTimeout(function(a){return function(){a.getAjaxDataSync(0,!0)}}(this),this.options.data.refresh)}},hideLoadingDivs:function hideLoadingDivs(){this.getLoadingDivs().remove()},updateLoadingDivs:function updateLoadingDivs(){if(this.data.length===this.options.data.size){this.clearAjaxLoading();this.hideLoadingDivs()}else{this.getLoadingDivs().find("div.progress .bar").css("width",parseInt(100*this.data.length/this.options.data.size,10)+"%")}},getAjaxDataAsync:function getAjaxDataAsync(b){a.ajax({url:this.options.data.url,type:this.options.data.type,data:{offset:b,limit:this.options.pageSize*this.options.pagingNumberOfPages},ajaxI:b,ajaxThis:this,success:function success(a){this.ajaxThis.data=this.ajaxThis.data.concat(a);this.ajaxThis.sort();this.ajaxThis.filter(!0);this.ajaxThis.updateLoadingDivs()},error:function error(a,b,c){console.log("ERROR: "+c+" - "+b);this.ajaxThis.getAjaxDataAsync(this.ajaxI)}})},getAjaxDataSync:function getAjaxDataSync(b,c){if("undefined"==typeof b){b=0}if("undefined"==typeof c){c=!1}if(c&&this.syncData===void 0){this.syncData=[]}a.ajax({url:this.options.data.url,type:this.options.data.type,data:{offset:b,limit:this.options.pageSize*this.options.pagingNumberOfPages},ajaxI:b,ajaxAllInOne:c,ajaxThis:this,success:function success(a){if(0!==a.length){if(this.ajaxAllInOne){this.ajaxThis.syncData=this.ajaxThis.syncData.concat(a)}else{this.ajaxThis.data=this.ajaxThis.data.concat(a);this.ajaxThis.sort();this.ajaxThis.filter(!0)}this.ajaxThis.getAjaxDataSync(this.ajaxI+this.ajaxThis.options.pageSize*this.ajaxThis.options.pagingNumberOfPages,this.ajaxAllInOne)}else{if(this.ajaxAllInOne){this.ajaxThis.data=this.ajaxThis.syncData;delete this.ajaxThis.syncData}this.ajaxThis.clearAjaxLoading();this.ajaxThis.hideLoadingDivs();this.ajaxThis.sort();this.ajaxThis.filter(!0)}},error:function error(a,b,c){console.log("ERROR: "+c+" - "+b);this.ajaxThis.getAjaxDataSync(this.ajaxI,this.ajaxAllInOne)}})},getHead:function getHead(){return this.table.find("thead").first()},getBody:function getBody(){return this.table.find("tbody").first()},getCounter:function getCounter(){return a(this.options.counterDivSelector)},getLoadingDivs:function getLoadingDivs(){return a(this.options.loadingDivSelector)},getPagingLists:function getPagingLists(){return a(this.options.pagingDivSelector).find("ul")},getLastPageNumber:function getLastPageNumber(){return parseInt(Math.ceil(this.filterIndex.length/this.options.pageSize),10)},updatePaging:function updatePaging(){var b=this.options.pagingNumberOfPages,c=this,d=parseInt(this.currentStart/this.options.pageSize,10)+1,e=this.getLastPageNumber(),f,g;if(d<b/2){f=1}else if(d>=e-b/2){f=e-b+1;if(1>f){f=1}}else{f=parseInt(d-b/2+1,10)}if(f+b<e+1){g=f+b-1}else{g=e}this.getPagingLists().each(function(){a(this).html("");if(c.options.firstPage){a(this).append("<li class=\""+(1===d?"active":"")+"\"><a data-page=\"first\">"+c.options.firstPage+"</a></li>")}if(c.options.prevPage){a(this).append("<li class=\""+(1===d?"active":"")+"\"><a data-page=\"prev\">"+c.options.prevPage+"</a></li>")}for(var b=f;b<=g;b++){a(this).append("<li class=\""+(b===d?"active":"")+"\"><a data-page=\""+b+"\">"+b+"</a></li>")}if(c.options.nextPage){a(this).append("<li class=\""+(d===e||0===e?"active":"")+"\"><a data-page=\"next\">"+c.options.nextPage+"</a></li>")}if(c.options.lastPage){a(this).append("<li class=\""+(d===e||0===e?"active":"")+"\"><a data-page=\"last\">"+c.options.lastPage+"</a></li>")}});this.getPagingLists().find("a").on("click.datatable",function(){if(a(this).parent("li").hasClass("active")){return}var b=a(this).data("page");switch(b){case"first":c.loadPage(1);break;case"prev":c.loadPage(d-1);break;case"next":c.loadPage(d+1);break;case"last":c.loadPage(e);break;default:c.loadPage(parseInt(b,10));}})},updateCounter:function updateCounter(){var a=this.filterIndex.length?parseInt(this.currentStart/this.options.pageSize,10)+1:0,b=parseInt(Math.ceil(this.filterIndex.length/this.options.pageSize),10),c=this.filterIndex.length?this.currentStart+1:0,d=this.currentStart+this.options.pageSize>this.filterIndex.length?this.filterIndex.length:this.currentStart+this.options.pageSize;this.getCounter().html(this.options.counterText(a,b,c,d,this.filterIndex.length))},getSortFunction:function getSortFunction(){if(!1===this.options.sort){return!1}if(jQuery.isFunction(this.options.sort)){return this.options.sort}if(0===this.data.length||!(this.options.sortKey in this.data[0])){return!1}var c=this.options.sortKey,d="asc"===this.options.sortDir;return function(e,a){var b=e[c],f=a[c];if(b>f){return d?1:-1}if(b<f){return d?-1:1}return 0}},destroyFilter:function destroyFilter(){a(".datatable-filter-line").remove()},changePlaceHolder:function changePlaceHolder(){var b=this.options.filterText?this.options.filterText:"";a(".datatable-filter-line input[type=\"text\"]").attr("placeholder",b)},createTextFilter:function createTextFilter(b){var c=this.options.filterText?"placeholder=\""+this.options.filterText+"\"":"",d=a("<input type=\"text\" class=\"datatable-filter datatable-input-text\" data-filter=\""+b+"\" "+c+"/>");this.filterVals[b]="";var e=function(){var a=0;return function(b,c){clearTimeout(a);a=setTimeout(b,c)}}();d.on("change keyup keydown",function(b){return function(){var c=a(this).val().toUpperCase(),d=a(this).data("filter");e(function(){b.filterVals[d]=c;b.filter()},300)}}(this));this.addFilter(b,function(a,b){return-1!==a.toUpperCase().indexOf(b)});d.addClass(this.options.filterInputClass);return d},createSelectFilter:function createSelectFilter(b){var c={},d=[],e=!1,f=!0,g="";if("select"===this.options.filters[b]){c=this.getFilterOptions(b)}else{e="multiple"in this.options.filters[b]&&!0===this.options.filters[b].multiple;f="empty"in this.options.filters[b]&&this.options.filters[b].empty;g="empty"in this.options.filters[b]&&"string"==typeof this.options.filters[b].empty?this.options.filters[b].empty:"";if("values"in this.options.filters[b]){if("auto"===this.options.filters[b].values){c=this.getFilterOptions(b)}else{c=this.options.filters[b].values}if("default"in this.options.filters[b]){d=this.options.filters[b].default}else if(e){d=[];for(var h in c){if(a.isPlainObject(c[h])){d=d.concat(Object.keys(c[h]))}else{d.push(h)}}}else{d=[]}if(!a.isArray(d)){d=[d]}}else{c=this.options.filters[b];d=e?Object.keys(c):[]}}var i=a("<select "+(e?"multiple=\"multiple\"":"")+" class=\"datatable-filter datatable-select\" data-filter=\""+b+"\"></select>");if(f){i.append("<option value=\"\">"+g+"</option>")}var j=[];for(var k in c){if(a.isPlainObject(c[k])){var l=a("<optgroup label=\""+k+"\"></optgroup>");for(var m in c[k]){if(c[k].hasOwnProperty(m)){j.push(m);l.append("<option value=\""+m+"\" "+(-1!==d.indexOf(m)||-1!==d.indexOf(parseInt(m))?"selected":"")+">"+c[k][m]+"</option>")}}i.append(l)}else{j.push(k);i.append("<option value=\""+k+"\" "+(-1!==d.indexOf(k)||-1!==d.indexOf(parseInt(k))?"selected":"")+">"+c[k]+"</option>")}}var n=i.val();this.filterVals[b]=e?n:f&&!n?j:[n];i.change(function(b,c,d,e){return function(){var f=a(this).val(),g=a(this).data("filter");e.filterVals[g]=c?f:d&&!f?b:[f];e.filter()}}(j,e,f,this));this.addFilter(b,function(a){return function(b,c){if(!c){return!1}if(c==a&&!b){return!0}return-1!==c.indexOf(b)}}(j));i.addClass(this.options.filterSelectClass);return i},createFilter:function createFilter(){this.filters=[];this.filterVals=[];if(this.options.filters){var b=a("<tr class=\"datatable-filter-line\"></tr>").insertAfter(this.table.find("thead tr").last());for(var c in this.options.filters){if(this.options.filters.hasOwnProperty(c)){var d=a("<td></td>");if(!1!==this.options.filters[c]){if(!0===this.options.filters[c]){d.append(this.createTextFilter(c))}else{d.append(this.createSelectFilter(c))}}b.append(d)}}}},filter:function filter(a){if("undefined"==typeof a){a=!1}var b=this.currentStart;this.currentStart=0;this.filterIndex=[];for(var c=0;c<this.data.length;c++){if(this.checkFilter(this.data[c])){this.filterIndex.push(c)}}if(a){this.currentStart=b;while(this.currentStart>=this.filterIndex.length){this.currentStart-=this.options.pageSize}if(0>this.currentStart){this.currentStart=0}}this.refresh()},checkFilter:function checkFilter(a){var b=!0;for(var c in this.filters){if(!this.filters[c](a[c],this.filterVals[c])){if("Absurdomanies"==a.serie){console.log("absurde = "+c+", "+a[c]+", "+this.filterVals[c])}b=!1;break}}return b},addFilter:function addFilter(a,b){this.filters[a]=b},getFilterOptions:function getFilterOptions(a){var b={},c=[];for(var d in this.data){if(""!==this.data[d][a]){c.push(this.data[d][a])}}c.sort();for(var e in c){if(c.hasOwnProperty(e)){b[c[e]]=c[e]}}return b},destroySort:function destroySort(){a("thead th").removeClass("sorting sorting-asc sorting-desc").unbind("click.datatable").removeData("sort")},createSort:function createSort(){var b=this;if(!jQuery.isFunction(this.options.sort)){var c=0;this.table.find("thead th").each(function(){if(a(this).data("sort")){b.options.sort=!0}else if("*"===b.options.sort){a(this).data("sort",c)}else{var d;if(jQuery.isArray(b.options.sort)){d=c}else if(jQuery.isPlainObject(b.options.sort)){d=Object.keys(b.options.sort)[c]}if(d!==void 0&&b.options.sort[d]){a(this).data("sort",d)}}if(a(this).data("sort")!==void 0){a(this).addClass("sorting")}c++});this.table.find("thead th").on("click.datatable",function(){if(a(this).data("sort")!==void 0){if(a(this).hasClass("sorting-asc")){b.options.sortDir="desc";a(this).removeClass("sorting-asc").addClass("sorting-desc")}else if(a(this).hasClass("sorting-desc")){b.options.sortDir="asc";a(this).removeClass("sorting-desc").addClass("sorting-asc")}else{a(this).parent("tr").find("th").removeClass("sorting-desc").removeClass("sorting-asc");b.options.sortDir="asc";b.options.sortKey=a(this).data("sort");a(this).addClass("sorting-asc")}b.sort();b.refresh()}})}},triggerSort:function triggerSort(){if(jQuery.isFunction(this.options.sort)){this.sort();this.refresh()}else if(!1!==this.options.sortKey){var b;this.table.find("tr th").removeClass("sorting-desc").removeClass("sorting-asc");this.table.find("th").each(function(c){return function(){if(a(this).data("sort")===c){b=a(this)}}}(this.options.sortKey));if(b!==void 0){b.addClass("sorting-"+this.options.sortDir);this.sort();this.refresh()}}},sort:function sort(){var a=this.getSortFunction();if(!1===a){return}this.data.sort(a)},identify:function identify(b,c){if(!1===this.options.identify){return!1}if(a.isFunction(this.options.identify)){return this.options.identify(b,c)}return c[this.options.identify]==b},indexOf:function indexOf(a){for(var b=-1,c=0;c<this.data.length&&-1===b;c++){if(this.identify(a,this.data[c])){b=c}}return b},row:function row(a){return this.data[this.indexOf(a)]},addRow:function addRow(a){this.data.push(a);this.sort();this.filter();this.currentStart=parseInt(this.filterIndex.indexOf(this.data.indexOf(a))/this.options.pageSize,10)*this.options.pageSize;this.refresh()},deleteRow:function deleteRow(a){var b=this.currentStart,c=this.indexOf(a);if(-1===c){console.log("No data found with id: "+a);return}this.data.splice(c,1);this.filter();if(b<this.filterIndex.length){this.currentStart=b}else{this.currentStart=b-this.options.pageSize;if(0>this.currentStart){this.currentStart=0}}this.refresh()},updateRow:function updateRow(a,b){var c=this.indexOf(a);if(-1!==c){if(a in b){delete b[a]}for(var d in this.data[c]){if(d in b){this.data[c][d]=b[d]}}this.sort();this.filter();this.currentStart=parseInt(this.filterIndex.indexOf(this.indexOf(a))/this.options.pageSize,10)*this.options.pageSize;this.refresh()}},loadPage:function loadPage(a){var b=this.currentStart/this.options.pageSize;if(1>a){a=1}else if(a>this.getLastPageNumber()){a=this.getLastPageNumber()}this.currentStart=(a-1)*this.options.pageSize;this.refresh();this.options.onChange(b+1,a)},getCurrentPage:function getCurrentPage(){return this.currentStart/this.options.pageSize+1},refresh:function refresh(){this.options.beforeRefresh();this.updatePaging();this.updateCounter();this.getBody().html("");if(this.currentStart>=this.currentDataLength){this.getBody().append("<tr><td colspan=\""+this.options.nbColumns+"\"><div class=\"progress progress-striped active\"><div class=\"bar\" style=\"width: 100%;\"></div></div></div></tr>");return}for(var a=0;a<this.options.pageSize&&a+this.currentStart<this.filterIndex.length;a++){this.getBody().append(this.options.lineFormat(this.filterIndex[this.currentStart+a],this.data[this.filterIndex[this.currentStart+a]]))}this.options.afterRefresh()},setOption:function setOption(a,b){if(a in this.options){this.options[a]=b;if("sort"===a){this.destroySort();this.createSort();this.triggerSort()}if("sortKey"===a||"sortDir"===a){this.sort()}if("filters"===a){this.destroyFilter();this.createFilter()}if("filterText"===a){this.changePlaceHolder()}this.filter()}},setOptions:function setOptions(a){for(var b in a){if(b in this.options){this.options[b]=a[b]}}if("sort"in a){this.destroySort();this.createSort();this.triggerSort()}else if("sortKey"in a||"sortDir"in a){this.sort()}if("filters"in a){this.destroyFilter();this.createFilter()}if("filterText"in a){this.changePlaceHolder()}this.filter()},destroy:function destroy(){if(this.refreshTimeOut!==void 0){clearTimeout(this.refreshTimeOut)}this.destroySort();a(this.options.pagingDivSelector).removeClass("pagination pagination-centered pagination-data-tables").html("");this.destroyFilter();this.table.removeClass("datatable");this.getBody().html("");for(var b=0;b<this.data.length;b++){this.getBody().append(this.options.lineFormat(b,this.data[b]))}}};a.fn.datatable=function(){var c=arguments,d=-1,e;if(0===c.length){c=[{}]}e=this.each(function(){if(a.isPlainObject(c[0])){if(this.datatable===void 0){this.datatable=new b(a(this),a.extend({},a.fn.datatable.defaults,c[0]))}else{this.datatable.setOptions(c[0])}}else if("string"==typeof c[0]){switch(c[0]){case"page":if(1 in c){this.datatable.loadPage(parseInt(c[1]))}else{d=this.datatable.getCurrentPage()}break;case"select":d=this.datatable.row(c[1]);break;case"insert":this.datatable.addRow(c[1]);break;case"update":this.datatable.updateRow(c[1],c[2]);break;case"delete":this.datatable.deleteRow(c[1]);break;case"option":this.datatable.setOption(c[1],c[2]);break;case"destroy":this.datatable.destroy();delete this.datatable;break;}}});return-1!==d?d:e};a.fn.datatable.defaults={pagingDivSelector:".paging",pagingDivClass:"pagination pagination-centered",pagingListClass:"",counterDivSelector:".counter",loadingDivSelector:".loading",sort:!1,sortKey:!1,sortDir:"asc",nbColumns:-1,pageSize:20,pagingNumberOfPages:9,identify:!1,onChange:function onChange(){},counterText:function counterText(a,b,c,d,e){return"Page "+a+" on "+b+". Starting at "+c+", ending at "+d+" over "+e+" entries."},firstPage:"&lt;&lt;",prevPage:"&lt;",nextPage:"&gt;",lastPage:"&gt;&gt;",filters:{},filterText:"Search... ",filterInputClass:"",filterSelectClass:"",beforeRefresh:function beforeRefresh(){},afterRefresh:function afterRefresh(){},lineFormat:function lineFormat(b,c){var d=a("<tr></tr>");d.data("id",b);for(var e in c){if(c.hasOwnProperty(e)){d.append("<td>"+c[e]+"</td>")}}return d}}})(window.jQuery);
//# sourceMappingURL=datatable-src.min.js.map
