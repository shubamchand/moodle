{"version":3,"sources":["format_card.js"],"names":["define","$","Ajax","init","touchHandler","event","touch","changedTouches","simulatedEvent","document","createEvent","initMouseEvent","touchstart","touchmove","touchend","type","window","screenX","screenY","clientX","clientY","target","dispatchEvent","preventDefault","ready","each","index","element","sectionwrapper","addEventListener","setEqualHeight","selector","length","selectorHeight","arr","css","elem","offsetHeight","push","Math","max","apply","getUrlParameter","sParam","sParameterName","i","sURLVariables","decodeURIComponent","location","search","substring","split","undefined","resize","on","id","this","closest","find","val","text","trim","html","M","util","get_string","removeClass","addClass","toggleClass","submit","e","opacity","visibility","animate","dragsort","dragSelector","dragBetween","dragEnd","section","data","courseid","sequence","map","get","toString","call","methodname","args","sectionid","done","placeHolderTemplate","course","format","get_config","container_node","container_class","section_node","section_class","swap_sections","Y","node1","node2","CSS","sectionlist","Node","all","get_section_selector","item","one","swap","process_sections","response","sectionfrom","sectionto","SELECTORS","action","temp","ele","str","stridx","newstr","content","create","sectiontitles","setHTML","getAttribute","lastIndexOf","substr","setAttribute","activity","activityid","toggle","oldsectionid","newsection","activitytomove","attr","newsectionid","activityidtomove","success","fadeOut","message","insertAfter","height","show"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Enhancements to Cards components for easy course accessibility.\n *\n * @module     format/remuiformat\n * @copyright  WisdmLabs\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'format_remuiformat/jquery.dragsort'], function($, Ajax) {\n\n    function init() {\n\n        var cardminHeight = 200;\n        $(document).ready(function() {\n            inittest();\n        });\n\n        function touchHandler(event) {\n            var touch = event.changedTouches[0];\n            var simulatedEvent = document.createEvent(\"MouseEvent\");\n                simulatedEvent.initMouseEvent({\n                    touchstart: \"mousedown\",\n                    touchmove: \"mousemove\",\n                    touchend: \"mouseup\"\n                }[event.type], true, true, window, 1,\n                touch.screenX, touch.screenY,\n                touch.clientX, touch.clientY, false,\n                false, false, false, 0, null);\n            touch.target.dispatchEvent(simulatedEvent);\n            event.preventDefault();\n        }\n\n        function inittest() {\n            $('a.wdm-drag-drop').each(\n                function(index, element) {\n                    var sectionwrapper = element;\n                    sectionwrapper.addEventListener(\"touchstart\", touchHandler, true);\n                    sectionwrapper.addEventListener(\"touchmove\", touchHandler, true);\n                    sectionwrapper.addEventListener(\"touchend\", touchHandler, true);\n                    sectionwrapper.addEventListener(\"touchcancel\", touchHandler, true);\n                }\n            );\n            // ...document.addEventListener(\"click\", touchHandler, true);.\n        }\n\n        // Function to set Equal Height of all cards.\n        var setEqualHeight = function(selector) {\n            if (selector.length > 0) {\n                var arr = [];\n                var selectorHeight;\n                selector.css(\"min-height\", \"initial\");\n                selector.each(function(index, elem) {\n                    selectorHeight = elem.offsetHeight;\n                    selectorHeight = (selectorHeight > cardminHeight) ? selectorHeight : cardminHeight;\n                    arr.push(selectorHeight);\n                });\n                selectorHeight = Math.max.apply(null, arr) + 55;\n                selector.css(\"min-height\", selectorHeight);\n            }\n        };\n\n        $(window).resize(function() {\n            setEqualHeight($('.single-card.wdm-col'));\n        });\n\n        // Mark Completion.\n        $('form.togglecompletion button').on('click', function() {\n            var id = $(this).closest(\"form\").find('input[name=\"id\"]').val();\n            if (id) {\n                var completion = $('.wdm-completion-status-' + id).text().trim();\n                if (completion == \"Completed\") {\n                    $('.wdm-completion-status-' + id).html(M.util.get_string('markcomplete', 'format_remuiformat'));\n                    $('.activity-check-' + id).removeClass(\"completed\");\n                } else {\n                    $('.wdm-completion-status-' + id).html(M.util.get_string('completed', 'format_remuiformat'));\n                    $('.activity-check-' + id).addClass(\"completed\");\n                }\n                $(this).closest(\".wdm-completion-container\").toggleClass(\"text-muted\");\n            }\n        });\n\n        $('.form.togglecompletion').submit(function(e) {\n            e.preventDefault();\n        });\n\n        // Set Equal height of cards on load.\n        setEqualHeight($('.single-card'));\n        $('#page-course-view-remuiformat span.section-modchooser-link').addClass(\"btn btn-primary\");\n        $('.single-card').css({ opacity: 0.0, visibility: \"visible\", }).animate({ opacity: 1.0, }, 600, \"swing\");\n\n        /**\n         * @param  {} sParam \n         */\n        function getUrlParameter(sParam) {\n            var sPageURL = decodeURIComponent(window.location.search.substring(1)),\n            sURLVariables = sPageURL.split('&'),\n            sParameterName,\n            i;\n\n            for (i = 0; i < sURLVariables.length; i++) {\n                sParameterName = sURLVariables[i].split('=');\n\n                if (sParameterName[0] === sParam) {\n                    return sParameterName[1] === undefined ? true : sParameterName[1];\n                }\n            }\n        }\n\n        /**\n         * It saves the activity order after drag and drop.\n         */\n        function saveOrder() {\n            var section = $(this).data('section');\n            var courseid = getUrlParameter('id');\n            var data = $(\".wdm-section-wrapper li\").map(function() {\n                return $(this).data(\"id\");\n            }).get();\n            var sequence = data.toString();\n            var sectionsave = Ajax.call([\n                {\n                    methodname: \"format_remuiformat_move_activities\",\n                    args: {courseid: courseid, sectionid: section, sequence: sequence}\n                }\n            ]);\n            sectionsave[0].done(function() {\n                // Ajax Done Code goes here.\n            });\n        }\n\n        $('.wdm-section-wrapper').dragsort({\n            dragSelector: \"a.wdm-drag-drop\",\n            dragBetween: true,\n            dragEnd: saveOrder,\n            placeHolderTemplate: \"<li class='placeHolder' style='border:1px solid gray;'></li>\"\n        });\n\n        M.course = M.course || {};\n\n        M.course.format = M.course.format || {};\n\n        M.course.format.get_config = function() {\n            return {\n                container_node: 'div',\n                container_class: 'cards',\n                section_node: 'div',\n                section_class: 'section'\n            };\n        };\n\n        /**\n         * Swap section\n         *\n         * @param {YUI} Y YUI3 instance\n         * @param {string} node1 node to swap to\n         * @param {string} node2 node to swap with\n         * @return {NodeList} section list\n         */\n        M.course.format.swap_sections = function(Y, node1, node2) {\n            var CSS = {\n                COURSECONTENT: 'course-content',\n                SECTIONADDMENUS: 'section_add_menus'\n            };\n\n            var sectionlist = Y.Node.all('.' + CSS.COURSECONTENT + ' ' + M.course.format.get_section_selector(Y));\n            // Swap menus.\n            sectionlist.item(node1).one('.' + CSS.SECTIONADDMENUS).swap(sectionlist.item(node2).one('.' + CSS.SECTIONADDMENUS));\n        };\n\n        /**\n         * Process sections after ajax response\n         *\n         * @param {YUI} Y YUI3 instance\n         * @param {array} response ajax response\n         * @param {string} sectionfrom first affected section\n         * @param {string} sectionto last affected section\n         * @return void\n         */\n        M.course.format.process_sections = function(Y, sectionlist, response, sectionfrom, sectionto) {\n            var CSS = {\n                SECTIONNAME: 'sectionname'\n            },\n            SELECTORS = {\n                SECTIONLEFTSIDE: '.left .section-handle .icon'\n            };\n\n            if (response.action == 'move') {\n                // If moving up swap around 'sectionfrom' and 'sectionto' so the that loop operates.\n                if (sectionfrom > sectionto) {\n                    var temp = sectionto;\n                    sectionto = sectionfrom;\n                    sectionfrom = temp;\n                }\n\n                // Update titles and move icons in all affected sections.\n                var ele, str, stridx, newstr;\n\n                for (var i = sectionfrom; i <= sectionto; i++) {\n                    // Update section title.\n                    var content = Y.Node.create('<span>' + response.sectiontitles[i] + '</span>');\n                    sectionlist.item(i).all('.' + CSS.SECTIONNAME).setHTML(content);\n                    // Update move icon.\n                    ele = sectionlist.item(i).one(SELECTORS.SECTIONLEFTSIDE);\n                    str = ele.getAttribute('alt');\n                    stridx = str.lastIndexOf(' ');\n                    newstr = str.substr(0, stridx + 1) + i;\n                    ele.setAttribute('alt', newstr);\n                    ele.setAttribute('title', newstr); // For FireFox as 'alt' is not refreshed.\n                }\n            }\n        };\n        // Call AJAX to set activity layout (Row or Card).\n        $('.wdm-section-wrapper .single-card-container .wdm-activity-actions .wdm-show-in-row').on('click', function() {\n            var courseid = getUrlParameter('id');\n            var section = $(this).data('wdmsectionid');\n            var activity = $(this).data('wdmactivityid');\n            var selector = $(this);\n            var activitysave = Ajax.call([\n                {\n                    methodname: \"format_remuiformat_show_activity_in_row\",\n                    args: {courseid: courseid, sectionid: section, activityid: activity}\n                }\n            ]);\n            activitysave[0].done(function(response) {\n                if (response.type == 'row') {\n                    $(selector).closest('.single-card-container').removeClass('col-lg-4 col-md-6 col-sm-12').addClass('col-12');\n                    $(selector).closest('.single-card-container .single-card').removeClass('wdm-col').addClass('wdm-min-row');\n                    $(selector).find('.wdmactivitytype').toggle();\n                } else {\n                    $(selector).closest('.single-card-container').removeClass('col-12').addClass('col-lg-4 col-md-6 col-sm-12');\n                    $(selector).closest('.single-card-container .single-card').removeClass('wdm-min-row wdm-row')\n                    .addClass('wdm-col');\n                    $(selector).find('.wdmactivitytype').toggle();\n                }\n                // SetEqualHeight($('.single-card'));.\n            });\n        });\n\n        // Call AJAX to move activity to specific section in cars format.\n        $('.wdm-section-wrapper .single-card-container .wdm-activity-actions .ecfsectionname').on('click', function() {\n            var courseid = getUrlParameter('id');\n            var oldsectionid = $(this).data('oldsectionid');\n            var newsection = $(this).data('sectionidtomove');\n            var activitytomove = $(this).closest('.single-card-container').attr('data-id');\n            var selector = $(this);\n            var activitymovetosection = Ajax.call([\n                {\n                    methodname: \"format_remuiformat_move_activity_to_section\",\n                    args: {\n                        courseid: courseid,\n                        newsectionid: newsection,\n                        oldsectionid: oldsectionid,\n                        activityidtomove: activitytomove\n                    }\n                }\n            ]);\n            activitymovetosection[0].done(function(response) {\n                if (response.success == 1) {\n                    $(selector).closest('.single-card-container').fadeOut('slow');\n                } else {\n                    $('<div class=\"wdmactivityerrormsg alert alert-danger mt-10\">' + response.message + '</div>')\n                    .insertAfter($(selector).closest('.single-card-container .wdm-activity-actions'));\n                }\n            });\n        });\n\n        // ... + Show full summary label show conditionally.\n        var summaryheight = $('.read-more-target .no-overflow').height();\n        if (summaryheight > 52) {\n            $('.read-more-trigger').show();\n        }\n    }\n    // Must return the init function.\n\n    return {\n        init: init\n    };\n});\n"],"file":"format_card.min.js"}