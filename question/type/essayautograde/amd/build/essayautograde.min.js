define ("qtype_essayautograde/essayautograde",["jquery","core/str"],function(a,b){var c={plugin:"qtype_essayautograde",str:{},itemtype:"",itemmatch:"",minwords:0,maxwords:0,editortype:"",editormaxtries:50,editorinterval:100,responsesample:"",responseoriginal:""};c.init=function(a,b,d,e,f,g){var h="";switch(b){case"chars":h=".";break;case"words":h="\\w+";break;case"sentences":h="[^\\.?!]+[\\.?!]";break;case"paragraphs":h="[^\\r\\n]+[\\r\\n]*";break;}c.itemtype=b;c.itemmatch=new RegExp(h,"g");c.minwords=d;c.maxwords=e;c.editortype=f;if(a){c.setup_read_only_files();c.setup_response_heights()}else{c.setup_itemcounts();c.setup_responsesample(g)}};c.setup_read_only_files=function(){b.get_strings([{key:"rotate",component:c.plugin},{key:"scale",component:c.plugin}]).done(function(a){c.str.rotate=a[0];c.str.scale=a[1];document.querySelectorAll(".attachments .read-only-file.image .img-responsive").forEach(function(a){if(a.dataset.buttons_added){return!0}a.dataset.buttons_added=!0;a.classList.add("border-0");a.classList.add("m-0");a.classList.add("p-0");var b=document.createElement("DIV");b.classList.add("border-0");b.classList.add("m-0");b.classList.add("p-0");b.classList.add("position-relative");b.classList.add("image-container");a.parentNode.insertBefore(b,a);b.appendChild(a);if(a.complete){c.set_image_dimensions(a,b)}else{a.onload=function(){c.set_image_dimensions(this,this.parentNode)}}var d=document.createElement("DIV");d.classList.add("border-0");d.classList.add("m-0");d.classList.add("p-0");d.classList.add("all-buttons");var e="rotate",f="Rotate",g=[],h=[0,90,180,270];for(var j in h){var k=h[j],l=k+"\xB0",m={angle:k};g.push(c.create_button(e,l,m,c.transform_image))}d.appendChild(c.create_buttonset(e,f,g));var e="scale",f="Scale",g=[],n=[.5,1,1.5,2];for(var j in n){var o=n[j],l="\xD7"+o,m={factor:o};g.push(c.create_button(e,l,m,c.transform_image))}d.appendChild(c.create_buttonset(e,f,g));b.parentNode.insertBefore(d,b.nextElementSibling)})})};c.set_image_dimensions=function(a,b){a.dataset.width=a.offsetWidth;a.dataset.height=a.offsetHeight;a.dataset.offset=a.offsetWidth-a.offsetHeight;a.dataset.ratio=a.offsetWidth/a.offsetHeight;b.dataset.width=b.offsetWidth;b.dataset.height=b.offsetHeight;b.style.height=b.dataset.height+"px";b.style.width=b.dataset.width+"px";b.style.transitionDuration="1s";a.style.position="absolute";a.style.transitionDuration="1s"};c.create_buttonset=function(a,b,c){var d=document.createElement("DIV");d.classList.add("bg-secondary");d.classList.add("rounded");d.classList.add("mt-1");d.classList.add("pl-1");d.classList.add("buttons");if(a){d.classList.add(a+"-buttons")}if(b){var e=document.createElement("SPAN");e.classList.add("font-weight-bold");e.appendChild(document.createTextNode(b+":"));d.appendChild(e)}if(c){for(var f in c){d.appendChild(c[f])}}return d};c.create_button=function(a,b,c,d){var e=document.createElement("BUTTON");e.setAttribute("type","button");e.classList.add("btn");e.classList.add("btn-light");e.classList.add("border");e.classList.add("rounded");e.classList.add("my-1");e.classList.add("ml-1");e.classList.add("mr-0");e.classList.add("px-2");if(a){e.classList.add(a+"-button")}if(b){e.appendChild(document.createTextNode(b))}if(c){for(var f in c){e.dataset[f]=c[f]}}if(d){e.addEventListener("click",d,!1)}return e};c.transform_image=function(){var a=this.parentNode;if(!a.matches(".buttons")){return!1}a.querySelectorAll(".btn-info").forEach(function(a){a.classList.remove("btn-info");a.classList.add("btn-light")});this.classList.remove("btn-light");this.classList.add("btn-info");var b=a.parentNode;if(!b.matches(".all-buttons")){return!1}var c=b.previousElementSibling;if(!c.matches(".image-container")){return!1}var d=c.querySelector("img");if(!d){return!1}var e=0,f=b.querySelector(".rotate-buttons .btn-info");if(f){e=f.dataset.angle}var g=1,f=b.querySelector(".scale-buttons .btn-info");if(f){g=f.dataset.factor}var h=d.style.transform;h=h.replace(/ *(rotate|scale|translate) *\([^)]*\)/g,"");if(e){h+=" rotate("+e+"deg)"}if(90==e||270==e){var i=d.dataset.ratio*g,j=d.dataset.offset*i;if(270==e){j=-j}h+=" translate("+j/2+"px, "+j/2+"px)";d.style.width=d.dataset.width*i+"px";c.style.height=c.dataset.width*i+"px"}else{d.style.width=d.dataset.width*g+"px";c.style.height=c.dataset.height*g+"px"}d.style.transform=h.trim();d.style.maxWidth="initial"};c.setup_response_heights=function(){a("textarea.qtype_essay_response").each(function(){a(this).height(1);a(this).height(this.scrollHeight)})};c.setup_itemcounts=function(){a(".qtype_essay_response").each(function(){var b=c.get_itemcount_id(this),d=a.Deferred();c.check_editor(this,d);a.when(d).done(a.proxy(function(){c.create_itemcount(this,b);c.setup_itemcount(this,b)},this,b))})};c.check_editor=function(b,d){var e="";switch(c.editortype){case"atto":e="[contenteditable=true]";break;case"tinymce":e="iframe";break;}if(""==e){d.resolve()}else{var f=setInterval(function(){if(a(b).find(e).length){clearInterval(f);d.resolve()}},c.editorinterval)}};c.create_itemcount=function(a,d){if(null===document.getElementById(d)){var e=document.createElement("DIV");e.setAttribute("id",d);e.setAttribute("class","itemcount");if("words"==c.itemtype){b.get_strings([{key:"maxwordslabel",component:c.plugin},{key:"maxwordswarning",component:c.plugin},{key:"minwordslabel",component:c.plugin},{key:"minwordswarning",component:c.plugin},{key:"countwordslabel",component:c.plugin}]).done(function(a){c.str.maxwordslabel=a[0];c.str.maxwordswarning=a[1];c.str.minwordslabel=a[2];c.str.minwordswarning=a[3];c.str.countwordslabel=a[4];var d=document.createElement("B");d.setAttribute("class","label");d.appendChild(document.createTextNode(c.str.countwordslabel+": "));var f=document.createElement("I");f.setAttribute("class","value");f.appendChild(document.createTextNode("0"));var a=document.createElement("SPAN");a.setAttribute("class","wordswarning rounded bg-danger text-light ml-2 px-2 py-1 d-none");var g=document.createElement("P");g.setAttribute("class","countwords mt-2 mb-0");g.appendChild(d);g.appendChild(f);g.appendChild(a);e.appendChild(g);if(c.minwords){d=document.createElement("B");d.setAttribute("class","label");d.appendChild(document.createTextNode(c.str.minwordslabel+": "));f=document.createElement("I");f.setAttribute("class","value");f.appendChild(document.createTextNode(c.minwords));g=document.createElement("P");g.setAttribute("class","minwords my-0");g.appendChild(d);g.appendChild(f);e.appendChild(g)}if(c.maxwords){d=document.createElement("B");d.setAttribute("class","label");d.appendChild(document.createTextNode(c.str.maxwordslabel+": "));f=document.createElement("I");f.setAttribute("class","value");f.appendChild(document.createTextNode(c.maxwords));g=document.createElement("P");g.setAttribute("class","maxwords my-0");g.appendChild(d);g.appendChild(f);e.appendChild(g)}})}else{b.get_strings([{key:c.itemtype,component:c.plugin}]).done(function(a){c.str.countitems=a[0];var d=document.createElement("B");d.setAttribute("class","label");d.appendChild(document.createTextNode(c.str.countitems+": "));var b=document.createElement("I");b.setAttribute("class","value");b.appendChild(document.createTextNode("0"));var f=document.createElement("P");f.setAttribute("class","countitems my-0");f.appendChild(d);f.appendChild(b);e.appendChild(f)})}a.parentNode.insertBefore(e,a.nextSibling)}};c.setup_itemcount=function(b,d){var e=c.get_editable_element(b);if(e){a(e).keyup(function(){c.show_itemcount(this,d)});c.show_itemcount(e,d)}};c.get_editable_element=function(b){if("TEXTAREA"==a(b).prop("tagName")){return b}var c=a(b).find("[contenteditable=true]");if(c.length){return c.get(0)}var e=b.getElementsByTagName("IFRAME");if(e.length){e=e[0];var f=e.contentWindow||e.contentDocument;if(f.document){f=f.document}if(f.body&&f.body.isContentEditable){return f.body}}var c=a(b).find("textarea");if(c.length){return c.get(0)}return null};c.get_textarea=function(b){if("TEXTAREA"==a(b).prop("tagName")){return b}return a(b).find("textarea").get(0)};c.get_textarea_name=function(b){var d=c.get_textarea(b);return a(d).attr("name")};c.get_itemcount_id=function(a){var b=c.get_textarea_name(a);return"id_"+b+"_itemcount"};c.escaped_id=function(a){return"#"+a.replace(/(:|\.|\[|\]|,|=|@)/g,"\\$1")};c.show_itemcount=function(b,d){if("TEXTAREA"==a(b).prop("tagName")){var e=a(b).val().match(c.itemmatch)}else{var e=a(b).text().match(c.itemmatch)}if(e){e=e.length}else{e=0}d=c.escaped_id(d);if("words"==c.itemtype){a(d+" .countwords .value").text(e);var f="";if(e){if(c.minwords&&c.minwords>e){f=c.str.minwordswarning}if(c.maxwords&&c.maxwords<e){f=c.str.maxwordswarning}}var g=document.querySelector(d+" .countwords .wordswarning");if(g){g.innerText=f;if(""==f){g.classList.add("d-none")}else{g.classList.remove("d-none")}}}else{a(d+" .countitems .value").text(e)}};c.setup_responsesample=function(d){if(""==d){return}c.responsesample=d;b.get_strings([{key:"hidesample",component:c.plugin},{key:"showsample",component:c.plugin}]).done(function(b){c.str.hidesample=b[0];c.str.showsample=b[1];var d=a(".qtext").find("p:not(:empty), div:not(:empty)");if(d.length){d=d.last()}else{d=a(".qtext")}d.append(a("<span></span>").click(function(){var b="",d="",e=!1;if(a(this).hasClass("showsample")){a(this).removeClass("showsample").addClass("hidesample").text(c.str.hidesample);b=c.responsesample;e=!0}else{a(this).removeClass("hidesample").addClass("showsample").text(c.str.showsample);b=c.responseoriginal}var f=null,g=a(this).closest(".qtext");if("audio"==c.editortype||"video"==c.editortype){f=g.find(".audiovideo_response_prompt")}else{var h=g.next(".ablock").find(".answer .qtype_essay_response");if(h.is("[name$='_answer']")){f=h}else{f=h.find("[contenteditable=true]");if(0==f.length){f=h.find("iframe").contents().find("[contenteditable=true]");if(0==f.length){f=h.find("[name$='_answer']")}}}}if(null===f||0==f.length){return!1}if("TEXTAREA"==f.prop("tagName")){d=f.val();f.val(b).keyup()}else{d=f.text();f.text(b).keyup()}if(e){c.responseoriginal=d}return!0}).trigger("click"))})};return c});
//# sourceMappingURL=essayautograde.min.js.map
